{% extends 'DashboardBundle:Common:backend2.html.twig' %}

{% block content %}
<style>
  .cropit-image-preview {
    background-color: #f8f8f8;
    background-size: cover;
    border: 1px solid #ccc;
    border-radius: 3px;
    margin-top: 7px;
    width: 600px;
    height: 250px;
    cursor: move;
  }
  .cropit-image-background {
    opacity: .2;
    cursor: auto;
  }
  .image-size-label {
    margin-top: 10px;
  }
  input {
    display: block;
  }
  .export {
    margin-top: 10px;
  }

  textarea{
    padding: 0px!important;
    text-indent: 0px!important;
    box-sizing: content-box!important;
    box-shadow: none!important;
  }
</style>
<div class="row">
  <div class="col s7">
    <div class="card">
      <div class="title">
        <h5>Flyer Design</h5>
      </div>
      <div class="content">
        <div style="width: 600px">
          {{flyer_view | raw}}
        </div>
      </div>
      <button class="export">Export</button>
    </div>
  </div>
  <div class="col s5">
    <div class="card">
      <div class="title">
        <h5>Flyer Information</h5>
      </div>
      <div class="content">
         {{ form_row(flyer_form.name) }}
      </div>
    </div>
    <div class="card">
      <div class="title">
        <h5>Email Information</h5>
      </div>
      <div class="content">
        {{ form_row(flyer_form.sender_name) }}
        {{ form_row(flyer_form.email) }}
        {{ form_row(flyer_form.email_reply) }}
        {{ form_row(flyer_form.subject) }}
        {{ form_row(flyer_form.message) }}
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block javascripts %}
  {{parent()}}

  {# GOOGLE MAP #}
  <script src="http://maps.googleapis.com/maps/api/js?libraries=weather,geometry,visualization,places,drawing&amp;sensor=false" type="text/javascript"></script>
  <script src="{{ asset('bundles/dashboard/assets/libraries/jquery-google-map/infobox.js') }}"></script>
  <script src="{{ asset('bundles/dashboard/assets/libraries/jquery-google-map/markerclusterer.js') }}"></script>
  <script src="{{ asset('bundles/dashboard/assets/libraries/jquery-google-map/jquery-google-map.js') }}"></script>
  <script src="{{ asset('bundles/dashboard/assets/js/map.js') }}"></script>
  {# END GOOGLE MAP #}
  <script src="{{asset('bundles/dashboard/bower_components/jquery-ui/ui/widget.js')}}" type="text/javascript"></script>
  <script src="{{asset('bundles/dashboard/bower_components/blueimp-file-upload/js/jquery.iframe-transport.js')}}" type="text/javascript"></script>
  <script src="{{asset('bundles/dashboard/bower_components/blueimp-file-upload/js/jquery.fileupload.js')}}" type="text/javascript"></script>
  <script src="{{asset('bundles/dashboard/bower_components/cloudinary-jquery-file-upload/cloudinary-jquery-file-upload.js')}}" type="text/javascript"></script>
  <script src="{{asset('bundles/dashboard/bower_components/cropit/dist/jquery.cropit.js')}}"></script>

  <script>

    function cropImages(){
      var crop_images = $('.image-editor');
      var result = [];
      for(var i = 0; i < crop_images.length; i++){
        var crop_image = $(crop_images[i]);
        var data_crop = crop_image.cropit('export');
        result.push(data_crop);
      }
      return result;
    }

    $(document).ready(function(){

      $.cloudinary.config({ cloud_name: 'dnm1l8ric', api_key: '146447182555489'})

      $('.image-editor').each(function(index, value){
        var elm = $(value);
        var img_src = elm.find('img').attr('src');
        elm.cropit({
          imageState: {
            src: img_src
          }
        });
      });

      $('.export').click(function() {
        var post_data = {};
        post_data.images = cropImages();
        console.log(post_data);
      });

      $('[data-type="flyer_text"]').click(function(){
        var flyer_text = $(this);

        if(flyer_text.data('element') == 'input') {
          var input = $('<input type="text">');
        }
        else{
          var input = $('<textarea></textarea>');
        }

        input.css('font-size', flyer_text.css('font-size'));
        input.css('height', flyer_text.css('height'));
        input.css('text-align', flyer_text.data('align'));
        input.css('margin', flyer_text.data('margin'));
        input.css('padding', flyer_text.data('padding'));

        input.blur(function(){
          flyer_text.removeClass('hide');
          flyer_text.html(input.val().replace(/\r\n|\n|\r/g, '<br>'));
          input.remove();
        });

        input.val($(flyer_text).html().replace(/<br>/g, "\n").trim());
        input.appendTo(flyer_text.parent());
        flyer_text.addClass('hide');
        input.focus();
      });

      {# MAP #}

      if ($('[data-map="true"]').length != 0) {
        var lat = {{ property.lat ? property.lat : '25.7823072' }};
        var lng = {{ property.lng ? property.lng : '-80.3011208' }};
        var map_input_id = 'property_address';
        var map_input_lat_id = 'property_lat';
        var map_input_lng_id = 'property_lng';
        var show_marker = '{{ property.lat and property.lng ? 'true'}}';
        google.maps.event.addDomListener(window, 'load', initialize(lat, lng,
                map_input_id, map_input_lat_id, map_input_lng_id, show_marker));
      }

      {# END MAP #}

    });
  </script>

{% endblock javascripts%}